/*
 * Copyright (C) 2011 Texas Instruments Incorporated - http://www.ti.com/
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */
/dts-v1/;

#include "am3517.dtsi"

/ {
	model = "TI AM3517 EVM (AM3517/05 TMDSEVM3517)";
	compatible = "asd,fs5-am3517", "ti,am3517", "ti,omap3";

    vmmc_fixed: vmmc {
        compatible = "regulator-fixed";
        regulator-name = "vmmc_fixed";
        regulator-min-microvolt = <3300000>;
        regulator-max-microvolt = <3300000>;
    };

	memory {
		device_type = "memory";
		reg = <0x80000000 0x10000000>; /* 256 MB */
	};

    wlan_en_reg: fixedregulator@2 {
        compatible = "regulator-fixed";
        regulator-name = "wlan-en-regulator";
        regulator-min-microvolt = <3300000>;
        regulator-max-microvolt = <3300000>;

        /*GPIO3 pin that drives WLAN_EN*/
        gpio = <&gpio1 3 0>;

        startup-delay-us = <70000>;
        enable-active-high;
    };

    fpga_spectro: fpga_spectro {
        compatible = "asd,fs5";

        pinctrl-names = "default";
        pinctrl-0 = <&fpga_pins>;

        bidi-gpios = <&gpio2 4 0
                      &gpio2 5 0
                      &gpio2 6 0
                      &gpio2 7 0
                      &gpio2 8 0
                      &gpio2 9 0
                      &gpio2 10 0
                      &gpio2 11 0>;
        ndata-gpios = <&gpio2 27 GPIO_ACTIVE_LOW>;
        naddr-gpios = <&gpio2 2 GPIO_ACTIVE_LOW>;
        nwrite-gpios = <&gpio2 3 GPIO_ACTIVE_LOW>;
        nwait-gpios = <&gpio2 31 0>;
        nreset-gpios = <&gpio5 22 GPIO_ACTIVE_LOW>;
        nint3-gpios = <&gpio5 23 0>;
        nint-gpios = <&gpio2 29 0>;
    };

    gps_pps: gps_pps {
        compatible = "pps-gpio";
        gpios = <&gpio1 27 0>;

        pinctrl-names = "default";
        pinctrl-0 = <&gps_pps_pin>;

        assert-falling-edge;
    };

    motor_speed: motor_speed {
        compatible = "ti-gptcounter";        

        pinctrl-names = "default";
        pinctrl-0 = <&motor_fg>;

        gptimer = <&timer10>;
        pp-rev = <2>;
    };
};

&omap3_pmx_wkup {
    wl12xx_wkup_pins: pinmux_wl12xx_wkup_pins {
        pinctrl-single,pins = <
            0x00c (PIN_OUTPUT | MUX_MODE4)       /*sys_boot1.gpio_3 - WLAN_EN*/ 
            0x010 (PIN_INPUT_PULLUP | MUX_MODE4)       /*sys_boot1.gpio_5 - SCL*/
            0x016 (PIN_INPUT_PULLUP | MUX_MODE4)       /*sys_boot1.gpio_8 - SDA*/
        >;
    };
};

&omap3_pmx_core {
    pinctrl-names = "default";
    pinctrl-0 = <&trigger>, <&optimize>;

    otg_drv_vbus: pinmux_otg_drv_vbus {
        pinctrl-single,pins = <
            0x212 (PIN_OUTPUT | MUX_MODE0)  /* usb0_drvvbus.usb0_drvvbus */
        >;
    };

    i2c1_pins: pinmux_i2c1_pins {
        pinctrl-single,pins = <
            0x18a (PIN_INPUT | MUX_MODE0)   /* i2c1_scl.i2c1_scl */
            0x18c (PIN_INPUT | MUX_MODE0)   /* i2c1_sda.i2c1_sda */
        >;
    };

    i2c2_pins: pinmux_i2c2_pins {
        pinctrl-single,pins = <
            0x18e (PIN_INPUT | MUX_MODE0)   /* i2c2_scl.i2c2_scl */
            0x190 (PIN_INPUT | MUX_MODE0)   /* i2c2_sda.i2c2_sda */
        >;
    };

    i2c3_pins: pinmux_i2c3_pins {
        pinctrl-single,pins = <
            0x192 (PIN_INPUT | MUX_MODE0)    /* i2c3_scl.i2c3_scl */
            0x194 (PIN_INPUT | MUX_MODE0)    /* i2c3_sda.i2c3_sda */
        >;
    };

    mmc2_pins: pinmux_mmc2_pins {
        pinctrl-single,pins = <
            0x128 (PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc2_clk.sdmmc2_clk */
            0x12a (PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc2_cmd.sdmmc2_cmd */
            0x12c (PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc2_dat0.sdmmc2_dat0 */
            0x12e (PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc2_dat1.sdmmc2_dat1 */
            0x130 (PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc2_dat2.sdmmc2_dat2 */
            0x132 (PIN_INPUT_PULLUP | MUX_MODE0)	/* sdmmc2_dat3.sdmmc2_dat3 */
            0x134 (PIN_INPUT_PULLUP | MUX_MODE1)     /* sdmmc2_dat4.sdmmc2_dir_dat0 */
            0x136 (PIN_INPUT_PULLUP | MUX_MODE1)     /* sdmmc2_dat5.sdmmc2_dir_dat1 */
            0x138 (PIN_INPUT_PULLUP | MUX_MODE1)     /* sdmmc2_dat6.sdmmc2_dir_cmd */
            0x13a (PIN_INPUT_PULLUP | MUX_MODE1)     /* sdmmc2_dat7.sdmmc2_clkin */
        >;
    };

    wl12xx_core_pins: pinmux_wl12xx_core_pins {
		pinctrl-single,pins = <
			0x196 (PIN_INPUT_PULLUP | MUX_MODE4)	 /* hdq_sio.gpio_170 - WLAN_IRQ*/
            0x126 (PIN_OUTPUT_PULLDOWN | MUX_MODE4)  /* sdmmc1_dat7.gpio_129 - WLAN_nOE */
		>;
	};
    
    fpga_pins: pinmux_fpga_pins {
        pinctrl-single,pins = <
            0x04e (PIN_INPUT | MUX_MODE4)           /* gpmc_a3.gpio_36 - BiDi[0] */
            0x050 (PIN_INPUT | MUX_MODE4)           /* gpmc_a4.gpio_37 - BiDi[1] */
            0x052 (PIN_INPUT | MUX_MODE4)           /* gpmc_a5.gpio_38 - BiDi[2] */
            0x054 (PIN_INPUT | MUX_MODE4)           /* gpmc_a6.gpio_39 - BiDi[3] */
            0x056 (PIN_INPUT | MUX_MODE4)           /* gpmc_a7.gpio_40 - BiDi[4] */
            0x058 (PIN_INPUT | MUX_MODE4)           /* gpmc_a8.gpio_41 - BiDi[5] */
            0x05a (PIN_INPUT | MUX_MODE4)           /* gpmc_a9.gpio_42 - BiDi[6] */
            0x05c (PIN_INPUT | MUX_MODE4)           /* gpmc_a10.gpio_43 - BiDi[7] */

            0x04c (PIN_OUTPUT_PULLUP | MUX_MODE4)   /* gpmc_a2.gpio_35 - nWRITE_STROBE */
            0x04a (PIN_OUTPUT_PULLUP | MUX_MODE4)   /* gpmc_a1.gpio_34 - nADDR_STROBE */
            0x08e (PIN_OUTPUT_PULLUP | MUX_MODE4)   /* gpmc_clk.gpio_59 - nDATA_STROBE */
            0x09e (PIN_INPUT | MUX_MODE4)           /* gpmc_wait1.gpio_63 - nWAIT */
            0x110 (PIN_OUTPUT_PULLUP | MUX_MODE4)   /* mcbsp2_dr.gpio_118 - nFGPA_RESET */            
            0x098 (PIN_INPUT | MUX_MODE4)           /* gpmc_nbe1.gpio_61 - INTERRUPT */
        >;
    };

    uart1_pins: pinmux_uart1_pins {
        pinctrl-single,pins = <
            0x14c (PIN_OUTPUT | MUX_MODE0)  		/* uart1_tx.uart1_tx */
            0x152 (PIN_INPUT | MUX_MODE0)  			/* uart1_rx.uart1_rx */
        >;
    };

	mcspi1_pins: pinmux_mcspi1_pins {
		pinctrl-single,pins = <
			0x198 (PIN_INPUT_PULLUP | MUX_MODE0) 	/* mcspi1_clk.mcspi1_clk */
			0x19a (PIN_INPUT_PULLUP | MUX_MODE0)	/* mcspi1_simo.mcspi1_simo */
			0x19c (PIN_INPUT_PULLUP | MUX_MODE0)	/* mcspi1_somi.mcspi1_somi */
            0x19e (PIN_INPUT_PULLUP | MUX_MODE0)    /* mcspi1_cs0.mcspi1_cs0 */
			0x1a0 (PIN_INPUT_PULLUP | MUX_MODE0)	/* mcspi1_cs1.mcspi1_cs1 */
			0x1a2 (PIN_INPUT_PULLUP | MUX_MODE0)	/* mcspi1_cs2.mcspi1_cs2 */
            0x1a4 (PIN_INPUT_PULLUP | MUX_MODE0)    /* mcspi1_cs3.mcspi1_cs3 */
		>;
	};

    mcspi2_pins: pinmux_mcspi2_pins {
        pinctrl-single,pins = <
            0x1a6 (PIN_INPUT_PULLUP | MUX_MODE0)    /* mcspi2_clk.mcspi2_clk */
            0x1a8 (PIN_INPUT_PULLUP | MUX_MODE0)    /* mcspi2_simo.mcspi2_simo */
            0x1aa (PIN_INPUT_PULLUP | MUX_MODE0)    /* mcspi2_somi.mcspi2_somi */
            0x1ac (PIN_INPUT_PULLUP | MUX_MODE0)    /* mcspi2_cs0.mcspi2_cs0 */
            0x1ae (PIN_INPUT_PULLUP | MUX_MODE0)    /* mcspi2_cs1.mcspi2_cs1 */
        >;
    };

    motor_fg: pinxmux_motor_fg {
        pinctrl-single,pins = <
            0x084 (PIN_INPUT | MUX_MODE2)          /* gpmc_ncs3.gpt10_pwm_evt - MOT_FG_3V3 */
        >;
    };

    motor_spd_pwm: pinmux_motor_spd {
        pinctrl-single,pins = <
            0x082 (PIN_OUTPUT | MUX_MODE2)           /* gpmc_ncs2.gpt9_pwm_evt - MOT_SPD_PWM */
        >;
    };

    trigger: pinmux_trigger {
        pinctrl-single,pins = <
            0x1b0 (PIN_INPUT | MUX_MODE4)           /* sys_nirq.gpio_0 - TRIGGER */
        >;
    };

    optimize: pinmux_optimize {
        pinctrl-single,pins = <
            0x1e4 (PIN_INPUT | MUX_MODE4)           /* hecc1_txd.gpio_130 - OPTIMIZE */
        >;
    };
};

&omap3_pmx_core2 {
    pinctrl-names = "default";
    pinctrl-0 = <&white_ref>;

    gps_pps_pin: pinmux_gps_pps {
        pinctrl-single,pins = <
            /* 0x25f6 - 0x25d8 = 0x01e */
            0x01e (PIN_INPUT | MUX_MODE4)           /* etk_d13.gpio_27 - GPS_PPS */
        >;
    };

    white_ref: pinmux_white_ref {
        pinctrl-single,pins = <
            0x020 (PIN_INPUT | MUX_MODE4)           /* etk_d14.gpio_28 - WHT_REF */
        >;
    };
};

&am35x_otg_hs {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&otg_drv_vbus>;
    clocks = <&hsotgusb_ick_am35xx>, <&hsotgusb_fck_am35xx>;
    clock-names = "hsotgusb_ick", "hsotgusb_fck";
    compatible = "ti,am35x-musb";
};

&usbhshost {
    /* Will be initialized in pdata-quirks */
    status = "disabled";
};

&usbhstll {
    status = "disabled";
};

/*&aes {
    status = "disabled";
};

&sham {
    status = "disabled";
};

&smartreflex_core {
    status = "disabled";
};*/

&usb_otg_hs {
    status = "disabled";
};

&davinci_emac {
	status = "okay";
};

&davinci_mdio {
	status = "okay";
};

&i2c1 {
	clock-frequency = <400000>;

    pinctrl-names = "default";
    pinctrl-0 = <&i2c1_pins>;

    status = "okay";

    s35390a: s35390a@30 {
         compatible = "sii,s35390a";
         reg = <0x30>;
    };
};

&i2c2 {
	clock-frequency = <100000>;

    pinctrl-names = "default";
    pinctrl-0 = <&i2c2_pins>;

    status = "okay";

    battery: sbs-battery@b {
        compatible = "ti,bq20z65", "sbs,sbs-battery";
        reg = <0xb>;
        battery-name = "battery";
        sbs,poll-retry-count = <2>;
        sbs,i2c-retry-count = <100>;
    };
};

&i2c3 {
	clock-frequency = <400000>;

    pinctrl-names = "default";
    pinctrl-0 = <&i2c3_pins>;

    status = "okay";
};

&uart1 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&uart1_pins>;
};

&mmc1 {
    vmmc-supply = <&vmmc_fixed>;
	bus-width = <4>;
};

&mmc2 {
    status = "okay";
    ti,non-removable;
    vmmc-supply = <&wlan_en_reg>;
    bus-width = <4>;
    cap-power-off-card;
    pinctrl-names = "default";
    pinctrl-0 = <&mmc2_pins>, <&wl12xx_core_pins>, <&wl12xx_wkup_pins>;

    #address-cells = <1>;
    #size-cells = <0>;
    wlcore: wlcore@2 {
        compatible = "ti,wl1271";
        nOE = <&gpio5 1 0>;
        reg = <2>;
        interrupt-parent = <&gpio6>;
        interrupts = <10 IRQ_TYPE_LEVEL_HIGH>;
        ref-clock-frequency = <26000000>;
    };
};

&mmc3 {
      status = "disabled";
};

&mcspi1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&mcspi1_pins>;
};

&mcspi2 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&mcspi2_pins>;

    ksz8794@1 {
        compatible = "ksz8794";
        spi-max-frequency = <50000000>;
        reg = <1>;
    };
};

&gpmc {
	ranges = <0 0 0x00000000 0x20000000>;

	nand@0,0 {
		linux,mtd-name= "micron,nand";
		reg = <0 0 4>;	/* CS0, offset 0, IO size 4 */
		nand-bus-width = <16>;
		gpmc,device-width = <2>;
		ti,nand-ecc-opt = "bch8";

        gpmc,cs-on-ns = <0>;
        gpmc,cs-rd-off-ns = <36>;
        gpmc,cs-wr-off-ns = <36>;

        gpmc,adv-on-ns = <6>;
        gpmc,adv-rd-off-ns = <24>;
        gpmc,adv-wr-off-ns = <36>;

        gpmc,we-on-ns = <6>;
        gpmc,we-off-ns = <30>;

        gpmc,oe-on-ns = <6>;
        gpmc,oe-off-ns = <48>;

        gpmc,page-burst-access-ns = <6>;
        gpmc,access-ns = <54>;
        gpmc,cycle2cycle-delay-ns = <60>;

        gpmc,rd-cycle-ns = <72>;
        gpmc,wr-cycle-ns = <72>;
        gpmc,wr-access-ns = <30>;
        gpmc,wr-data-mux-bus-ns = <0>;

		#address-cells = <1>;
		#size-cells = <1>;

		partition@0 {
			label = "MLO";
			reg = <0 0x20000>;
		};
		partition@0x20000 {
			label = "uboot";
			reg = <0x20000 0x100000>;
		};
		partition@0x120000 {
			label = "u-boot-env";
			reg = <0x120000 0x40000>;
		};
		partition@0x160000 {
			label = "ubi";
			reg = <0x160000 0x1FEA0000>;
		};
	};

};
